;

var spoods_widget_lib = {
    hasAttribute: function(element, attribute_name) {
        var tmp = element.getAttribute(attribute_name);

        return ((tmp !== null) && (tmp !== ''));
    },

    randomString: function() {
        return Math.random().toString(36).substring(7);
    }
};

var spoods_verge = (function() {function a(){return{width:k(),height:l()}}function b(a,b){var c={};return b=+b||0,c.width=(c.right=a.right+b)-(c.left=a.left-b),c.height=(c.bottom=a.bottom+b)-(c.top=a.top-b),c}function c(a,c){return a=a&&!a.nodeType?a[0]:a,a&&1===a.nodeType?b(a.getBoundingClientRect(),c):!1}function d(b){b=null==b?a():1===b.nodeType?c(b):b;var d=b.height,e=b.width;return d="function"==typeof d?d.call(b):d,e="function"==typeof e?e.call(b):e,e/d}var e={},f="undefined"!=typeof window&&window,g="undefined"!=typeof document&&document,h=g&&g.documentElement,i=f.matchMedia||f.msMatchMedia,j=i?function(a){return!!i.call(f,a).matches}:function(){return!1},k=e.viewportW=function(){var a=h.clientWidth,b=f.innerWidth;return b>a?b:a},l=e.viewportH=function(){var a=h.clientHeight,b=f.innerHeight;return b>a?b:a};return e.mq=j,e.matchMedia=i?function(){return i.apply(f,arguments)}:function(){return{}},e.viewport=a,e.scrollX=function(){return f.pageXOffset||h.scrollLeft},e.scrollY=function(){return f.pageYOffset||h.scrollTop},e.rectangle=c,e.aspect=d,e.inX=function(a,b){var d=c(a,b);return!!d&&d.right>=0&&d.left<=k()},e.inY=function(a,b){var d=c(a,b);return!!d&&d.bottom>=0&&d.top<=l()},e.inViewport=function(a,b){var d=c(a,b);return!!d&&d.bottom>=0&&d.right>=0&&d.top<=l()&&d.left<=k()},e})();

(function(win, spoods_widget_lib, verge) {
    var doc                 = win.document;
    var inited              = false;
    var widget_base_url     = '//player.spoods.io/';
    var css_url             = '//widget.spoods.io/widget/native/2016-06-08/default.css';
    var base_tracking_url   = '//player.spoods.io/tracker/';
    var track_event_list    = [];
    var protocol            = '';
    var inside_iframe       = false;
    var bc_player_list      = {};
    var VERSION             = 2;

    function init() {
        try{
            if( parent !== win ) {
                inside_iframe = true;
            }
        }
        catch (e) {}

        if(inited === false) {
            try{
                inited = true;

                if( doc.location && doc.location.protocol ) {
                    if( ('http:' === doc.location.protocol) || ('https:' === doc.location.protocol) ) {
                        protocol = doc.location.protocol;
                    }
                }

                widget_base_url     = protocol + widget_base_url;
                css_url             = protocol + css_url;
                base_tracking_url   = protocol + base_tracking_url;

                var list = getPlayers();
                setPlayersDone(list);
                loadPlayer(list);
            }
            catch (e) {
                if(win.console) {
                    console.log('init', e);
                }
            }
        }
    }

    function getPlayers() {
        return getArrayByClassName(doc, 'spoods_widget_container', 'div');
    }

    function getArrayByClassName(node, classname, tagname) {
        var result = [];
        var i;

        // has browser function to get elements by classname?
        if(typeof node.getElementsByClassName === 'function') {
            var tmp = node.getElementsByClassName(classname);
            for(i=0;i < tmp.length; i++) {
                result.push(tmp[i]);
            }
            return result;
        }

        if( typeof tagname === 'undefined' ) {
            tagname = '*'; // all tags
        }

        var all_playerlist = node.getElementsByTagName(tagname);

        for(i=0; i < all_playerlist.length; i++) {
            if( hasClassName(all_playerlist[i],classname) ) {
                result.push(all_playerlist[i]);
            }
        }

        return result;
    }

    function hasClassName(element, classname) {
        return ( (' ' + element.className + ' ').replace(/[\n\t]/g, ' ').indexOf(' ' + classname + ' ') > -1 );
    }

    function setPlayersDone(playerlist) {
        for(var i=0; i < playerlist.length; i++) {
            playerlist[i].className = 'spoods_widget_container_done';
        }
    }

    function loadPlayer(playerlist) {
        var cb_id = spoods_widget_lib.randomString();
        var id_found = false;
        var random_id = '';
        var data_url = widget_base_url + 'data/?url=' + encodeURIComponent(getUrl()) + '&cb=' + cb_id + '&v=' + VERSION + '&ts=' + (new Date).getTime();

        win['spoods_callback_' + cb_id] = function(data, device_type) {
            initPlayers(data, device_type);
        };

        for(var i=0; i < playerlist.length; i++) {
            if( true === spoods_widget_lib.hasAttribute(playerlist[i],'data-key') ) {
                random_id = spoods_widget_lib.randomString();

                playerlist[i].id = 'spoods_widget_' + random_id;

                data_url += '&pids[' + encodeURIComponent(random_id) + ']=' + encodeURIComponent(playerlist[i].getAttribute('data-key'));

                id_found = true;
            }
        }

        if(true === id_found) {
            attachScriptToHead(data_url);
            //attachStyleToHead(css_url);
        }
    }

    function initPlayers(data, device_type) {
        var tmp_player,tmp_fake_player,tmp_close_btn,tmp_ov_wrapper,tmp_id,tmp_html_id,tmp_wuid,tmp_is_overlay,i,j,tmp_overlay_player,tmp_iframe,tmp_iframe_win,tmp_iframe_src,tmp_iframe_doc,tmp_iframe_wrapper;
        var bc_script_src_added = false;

        try {
            for(i=0;i<data.length;i++) {
                tmp_id = data[i].id;
                tmp_html_id = data[i].html_id;
                tmp_wuid = data[i].wuid;
                tmp_is_overlay = data[i].overlay;
                tmp_player = doc.getElementById(tmp_html_id);
                //tmp_player.className = tmp_player.className + " spoods-widget-" + device_type;
                tmp_player.innerHTML = data[i].html;
                tmp_player.style.display = 'inline-block';
                tmp_overlay_player = doc.getElementById('spoods_overlay_' + tmp_id);
                tmp_iframe_src = data[i].iframe_html;

                if( 'normal' === data[i].type ) {
                    bc_player_list[tmp_id] = {
                        'iframe': null,
                        'overlay': tmp_overlay_player
                    };

                    tmp_fake_player = getArrayByClassName(tmp_player, 'spoods-spot-fake', 'div');

                    for (j = 0; j < tmp_fake_player.length; j++) {
                        addEvent(tmp_fake_player[j], 'click', (function (tmp_id, tmp_html_id, tmp_wuid, tmp_is_overlay) {
                            startPlayer(tmp_id, tmp_html_id, tmp_wuid, tmp_is_overlay);
                        }).bind(null,tmp_id, tmp_html_id, tmp_wuid, tmp_is_overlay));
                    }

                    if(tmp_is_overlay) {
                        attachElement(tmp_overlay_player, doc.getElementsByTagName('body')[0]);

                        tmp_close_btn = getArrayByClassName(tmp_overlay_player, 'spoodswidget-overlay-close', 'div');

                        for (j = 0; j < tmp_close_btn.length; j++) {
                            addEvent(tmp_close_btn[j], 'click', (function (tmp_id) {
                                closeOverlay(tmp_id);
                            }).bind(null,tmp_id));
                        }

                        // TODO: click on wrapper (and ONLY the wrapper) => close overlay
                        tmp_ov_wrapper = getArrayByClassName(tmp_overlay_player, 'spoodswidget-overlay-content-wrapper', 'div');
                        for (j = 0; j < tmp_ov_wrapper.length; j++) {
                            addEvent(tmp_ov_wrapper[j], 'click', (function (tmp_id, event) {
                                if( event && event.target ) {
                                    if( hasClassName(event.target, 'spoodswidget-overlay-content-wrapper') ) {
                                        closeOverlay(tmp_id);
                                    }
                                }
                            }).bind(null,tmp_id));
                        }
                    }

                    tmp_iframe = doc.getElementById('spoods_bc_' + tmp_id + '_iframe');
                    tmp_iframe_win = tmp_iframe.contentWindow;
                    tmp_iframe.onload = (function(tmp_id, tmp_wuid, tmp_iframe_win, tmp_iframe_src) {
                        iframe_init(tmp_id, tmp_wuid, tmp_iframe_win, tmp_iframe_src);
                    }).bind(null, tmp_id, tmp_wuid, tmp_iframe_win, tmp_iframe_src);

                    win.setTimeout(
                        (function(tmp_id, tmp_wuid, tmp_iframe_win, tmp_iframe_src) {
                            iframe_init(tmp_id, tmp_wuid, tmp_iframe_win, tmp_iframe_src);
                        }).bind(null, tmp_id, tmp_wuid, tmp_iframe_win, tmp_iframe_src)
                    ,500);

/*
                    if(false === bc_script_src_added) {
                        if (typeof define === 'function' && define.amd) {
                            if (typeof define === 'function' && define.amd) {
                                require.config({
                                    'paths': {
                                        'bc': bc_script_src.substr(0,bc_script_src.length - 3)
                                    },
                                    timeout: 30
                                });

                                require(['bc'], function() {});
                            }
                        }
                        else {
                            attachScriptToHead(bc_script_src);
                        }

                        bc_script_src_added = true;
                    }*/

                    /*win.setTimeout(
                        if( typeof videojs === 'function' ) {
                            videojs('spoods_bc_' + tmp_id).on('error', function(ev){
                                try {
                                    var error = videojs(ev.target).error();
                                    // shorten error message if too long
                                    if(
                                        (typeof error === 'object') &&
                                        (typeof error.message === 'string') &&
                                        (error.message.length > 120)
                                    ) {
                                        error.message = error.message.substr(0,120 - 4) + ' ...';
                                    }
                                    trackEvent(tmp_html_id, tmp_wuid, 'error', error);
                                }
                                catch (e) {}
                            });
                        }
                    ,500);*/

                    win.setTimeout(getViewportIntervalFunction(tmp_html_id, tmp_wuid, false, 500), 500);
                }
                else if( 'veeseo' === data[i].type ) {
                    initRCWSpoods();
                }
            }
        }
        catch (e) {
            if(win.console) {
                console.log('initPlayers', e);
            }
        }
    }

    function iframe_init(id, wuid, iframe_win, iframe_src) {
        try {
            if(bc_player_list[id]['iframe'] === null) {
                var iframe_doc = iframe_win.document;
                iframe_doc.open();
                iframe_doc.write(iframe_src);
                iframe_doc.close();

                bc_player_list[id]['iframe'] = iframe_win;

                win.setTimeout(
                    (function( id, wuid, iframe_win ) {
                        if( typeof iframe_win.videojs === 'function' ) {
                            iframe_win.videojs('bc_player').on('error', function(ev){
                                try {
                                    var error = iframe_win.videojs(ev.target).error();
                                    // shorten error message if too long
                                    if(
                                        (typeof error === 'object') &&
                                        (typeof error.message === 'string') &&
                                        (error.message.length > 120)
                                    ) {
                                        error.message = error.message.substr(0,120 - 4) + ' ...';
                                    }
                                    trackEvent(id, wuid, 'error', error);
                                }
                                catch (e) {}
                            });
                        }
                    }).bind(null, id, wuid, iframe_win)
                ,500);
            }
        }
        catch (e) {
            if(win.console) {
                console.log('iframe_init', e);
            }
        }
    }

    function startPlayer(id, html_id, wuid, is_overlay) {
        try {

            if(is_overlay) {
                bc_player_list[id]['overlay'].style.display = 'block';
                //doc.getElementById('spoods_overlay_' + id).style.display = 'block';
            }
            else {
                doc.getElementById('spoods_spot_fake_' + id).style.display = 'none';
                doc.getElementById('spoods_bc_' + id + '_wrapper').style.display = 'block';
            }

            trackEvent(html_id, wuid, 'viewport');
            trackEvent(html_id, wuid, 'videoview');

            bc_player_list[id]['iframe'].videojs('bc_player').play();
            //videojs('spoods_bc_' + id).play();
        }
        catch (e) {
            if(win.console) {
                console.log('startPlayer', e);
            }
        }
    }

    function closeOverlay(id) {
        try {
            bc_player_list[id]['iframe'].videojs('bc_player').pause();
            //videojs('spoods_bc_' + id).pause();
        }
        catch (e) {
            if(win.console) {
                console.log('closeOverlay', e);
            }
        }

        bc_player_list[id]['overlay'].style.display = 'none';
    }

    function attachScriptToHead(url, onload_func, id) {
        var script = doc.createElement('script');
        script.type = 'text/javascript';

        if( typeof id !== 'undefined' ) {
            script.id = id;
        }

        if( typeof onload_func === 'function' ) {
            script.onload = onload_func;
        }

        attachElementToHead(script);

        script.src = url;

        return script;
    }

    function attachStyleToHead(url) {
        var slink = doc.createElement('link');
        slink.type = 'text/css';
        slink.rel = 'stylesheet';
        slink.href = url;

        return attachElementToHead(slink);
    }

    function attachElementToHead(element) {
        return attachElement(element, doc.getElementsByTagName('head')[0]);
    }

    function attachElement(element, parent) {
        return parent.appendChild(element);
    }

    function getUrl() {
        var url = doc.URL;

        // remove everything after hashtag (including hashtag itself)
        var hash_position = url.indexOf("#");

        if(hash_position != -1) {
            url = url.substring(0,hash_position);
        }

        return url;
    }

    function addEvent(element, event, func) {
        if( element.attachEvent ) {
            element.attachEvent('on'+event, func);
        }
        else {
            element.addEventListener(event, func, false);
        }
    }

    function getViewportIntervalFunction(html_id, wuid, hit, delay) {
        return function() {
            if(isElementInViewport(doc.getElementById(html_id))) {
                if( true === hit ) {
                    trackEvent(html_id, wuid, 'viewport');

                    return;
                }
                else {
                    hit = true;
                }
            }
            else {
                hit = false;
            }

            win.setTimeout(getViewportIntervalFunction(html_id,wuid,hit,delay),delay);
        }
    }

    function isElementInViewport(element) {
        if( typeof element.getBoundingClientRect === 'function' ) {
            var rect = element.getBoundingClientRect();
            if( (rect.height > 0) && (rect.width > 0) ) {
                var winHeight = win.innerHeight || doc.documentElement.clientHeight;

                var h8 = (rect.height * 0.08);
                var minHeight = rect.height - (h8 + h8);

                if( minHeight < winHeight ) {
                    // Widget kleiner als FensterhÃ¶he
                    if( ( (rect.top + h8) > 0) && ( (rect.bottom - h8) < winHeight) ) {
                        return true;
                    }
                }
                else {
                    // Widget grÃ¶ÃŸer als FensterhÃ¶he
                    if( (rect.bottom > 0) && (rect.bottom < winHeight) ) {
                        return true;
                    }
                }
            }
        }

        return false;
    }

    function trackEvent(html_id, wuid, event, additional_data) {
        var track_event_list_id = html_id + '_' + event;

        if( track_event_list.indexOf(track_event_list_id) < 0 ) {
            track_event_list.push(track_event_list_id);

            var url = base_tracking_url + '?wuid=' + wuid + '&event=' + event + '&ts=' + (new Date).getTime();
            if(
                (typeof additional_data !== 'undefined') &&
                (typeof JSON !== 'undefined') &&
                (typeof JSON.stringify === 'function')
            ) {
                url = url + '&data=' + JSON.stringify(additional_data);
            }

            var elem_to_add = doc.getElementById(html_id);
            var img = doc.createElement('img');
            img.src = url;
            img.style.display = 'none';
            img.onload = function () {
                try {
                    elem_to_add.removeChild(img);
                }
                catch (e) {
                }
            };
            img.onerror = function () {
                /* if img's are blocked, try script */
                attachScriptToHead(url + '&transport=js');
            };

            elem_to_add.appendChild(img);
        }
    }

    if( (typeof doc.readyState !== 'undefined') && ((doc.readyState === 'complete') || (doc.readyState === 'interactive')) ) {
        init();
    }
    else {
        //TODO: cross browser compatibility?!
        if(typeof doc.addEventListener !== 'undefined') {
            doc.addEventListener('DOMContentLoaded', function() {
                init();
            });
        }
        else if(typeof win.attachEvent !== 'undefined') {
            win.attachEvent('onload', function() {
                init();
            });
        }
    }

    win.setTimeout(function() {
        init();
    },5000);


})(window, spoods_widget_lib, spoods_verge);

/** fallback code **/
var vee_sp_data;

function initRCWSpoods() {
    veeseoFixIndexOf();
    "undefined" == typeof vee_sp_data && (vee_sp_data = {
        dom: [],
        data: [],
        done: [],
        used: []
    });
    var c, b = veeseoRemoveURLNumberSign(document.URL),
        a = window.location.host,
        a = a.toLowerCase(),
        e = [];
    c = "function" != typeof document.getElementsByClassName ? veeseoGetElementsByClassName("veeseo_spoods_container") : document.getElementsByClassName("veeseo_spoods_container");
    for (var d = 0; d < c.length; d++) {
        var g = c[d].getAttribute("overrideDomain"),
            f = a;
        g && (f = g);
        f = f.toLowerCase();
        0 > vee_sp_data.dom.indexOf(f) && (vee_sp_data.dom.push(f), e.push(f))
    }
    g = !1;
    if (void 0 != c && void 0 != c[0])
        for (d = 0; d < e.length; d++) veeseoLoadSpoodsData(b, e[d], a != e[d]), g = !0;
    g || veeseoUpdateSpoodsContainers();
    return !0
}

function veeseoSpoods2(c) {
    if (!(c.players && c.embedcode && c.spots && c.language)) return !1;
    var b = window.location.host,
        b = b.toLowerCase();
    "undefined" != typeof c.domain && (b = c.domain);
    vee_sp_data.data[b] = c;
    veeseoUpdateSpoodsContainers()
}

function veeseoUpdateSpoodsContainers() {
    var c = window.location.host,
        c = c.toLowerCase();
    spoodscontainer = "function" != typeof document.getElementsByClassName ? veeseoGetElementsByClassName("veeseo_spoods_container") : document.getElementsByClassName("veeseo_spoods_container");
    for (var b = [], a = 0; a < spoodscontainer.length; a++)
        if (0 > vee_sp_data.done.indexOf(spoodscontainer[a].id)) {
            var e = spoodscontainer[a].getAttribute("overrideDomain"),
                d = c;
            e && (d = e);
            d = d.toLowerCase();
            "undefined" != typeof vee_sp_data.data[d] && (0 < veeseoAddSpot(spoodscontainer[a], vee_sp_data.data[d], d) && 0 > b.indexOf(d) && b.push(d), vee_sp_data.done.push(spoodscontainer[a].id))
        }
    for (a = 0; a < b.length; a++) eval(vee_sp_data.data[b[a]].embedcode)
}

function veeseoAddSpot(c, b, a) {
    var e = 0,
        d = b.language,
        g = c.id,
        g = void 0 != g && "" != g && "player_" == g.substr(0, 7) ? g.substr(7) : "default",
        f = b.players[g];
    if (void 0 == f) return 0;
    var f = f.html,
        k = b.players[g].spotType,
        h = b.spots[k].spots;
    b = b.spots[k].isFinal;
    void 0 != f && "" != f && 0 < h.length && (h = veeseoSelectSpot(h), f = f.replace("%%EXTERNAL_ID%%", h), c.innerHTML = f + '<div style="display:none"><img src="http://tracking.rce.veeseo.com/spoods/load.gif?url=' + encodeURIComponent(document.URL) + "&item[0]=" + h + "&widget=Spoods&player=" + g + "&type=" + (b ? "semantic" : "generic") + "&category[0]=" + encodeURIComponent(a) + "&ts=" + (new Date).getTime() + "&mediatype=text&language=" + encodeURIComponent(d) + '"></div>', c.style.display = "block", e++);
    return e
}

function veeseoLoadSpoodsData(c, b, a) {
    a && (c += "#override=" + encodeURIComponent(b));
    c = "http://rce.veeseo.com/data/spoods/rec.spoods?url=" + encodeURIComponent(c) + "&category[0]=" + encodeURIComponent(b) + "&ts=" + (new Date).getTime() + "&pagetimestamp=0&mediatype=text";
    b = document.getElementsByTagName("head")[0];
    a = document.createElement("script");
    a.type = "text/javascript";
    a.src = c;
    b.appendChild(a)
}

function veeseoSelectSpot(c) {
    for (var b = !0, a = 0; a < c.length; a++) 0 > vee_sp_data.used.indexOf(c[a].external_id) && (b = !1);
    if (!b)
        for (a = 0; a < c.length; a++) 0 <= vee_sp_data.used.indexOf(c[a].external_id) && (c[a].weight = 0);
    for (a = b = 0; a < c.length; a++) b += c[a].weight;
    for (var e = Math.random() * b, d = 0, a = b = 0; a < c.length; a++) e >= b && e < b + c[a].weight && (d = c[a].external_id), b += c[a].weight;
    vee_sp_data.used.push(d);
    return d
}

function veeseoGetElementsByClassName(c) {
    var b = document.getElementsByTagName("*"),
        a = [];
    for (i = 0; i < b.length; i++)
        if (b[i].getAttribute("class"))
            for (ecl = b[i].getAttribute("class").split(" "), j = 0; j < ecl.length; j++) ecl[j].toLowerCase() == c.toLowerCase() && a.push(b[i]);
        else if (b[i].className)
            for (ecl = b[i].className.split(" "), j = 0; j < ecl.length; j++) ecl[j].toLowerCase() == c.toLowerCase() && a.push(b[i]);
    return a
}

function veeseoRemoveURLNumberSign(c) {
    var b = String(c.indexOf("#"));
    return -1 != b ? c.substring(0, b) : c
}

function veeseoFixIndexOf() {
    Array.prototype.indexOf || (Array.prototype.indexOf = function(c, b) {
        for (var a = b || 0, e = this.length; a < e; a++)
            if (this[a] === c) return a;
        return -1
    })
};¶‹zÌô      Wû{³Wû{´<üÁWüBƒ   "    :http://widget.spoods.io/loader.js necko:classified 1 strongly-framed 1 request-method GET response-head HTTP/1.1 200 OK
Content-Type: application/x-javascript
Last-Modified: Tue, 28 Jun 2016 21:50:20 GMT
Via: 1.1 4cef090fba24867bb1a518bc7c5a1e98.cloudfront.net (CloudFront), 1.1 ISA01TMG
Age: 35504
Date: Mon, 10 Oct 2016 11:29:55 GMT
Server: AmazonS3
Cache-Control: max-age=86400,public
Vary: Accept-Encoding
X-Cache: Hit from cloudfront
X-Amz-Cf-Id: EIkjTDUh2Tx8rj7oT9RvjZpDPwdDQv_jvhL5Td5Of_kuorfGAFJ-KQ==
 original-response-headers Via: 1.1 0f820adb6671fcc6033a9aa95ec8e0fb.cloudfront.net (CloudFront), 1.1 ISA01TMG
Connection: Keep-Alive
Proxy-Connection: Keep-Alive
Transfer-Encoding: chunked
Age: 44773
Date: Thu, 22 Sep 2016 17:58:15 GMT
Content-Type: application/x-javascript
Server: AmazonS3
Last-Modified: Tue, 28 Jun 2016 21:50:20 GMT
Cache-Control: max-age=86400,public
X-Cache: Hit from cloudfront
X-Amz-Cf-Id: XE3jDZc1jlgYVdn8mssTKyZp4_IS8KeIQ4YuWfBfcayOZCkYv-zAfA==
 uncompressed-len 0 request-Accept-Encoding gzip, deflate   _÷